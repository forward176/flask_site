<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lvl {{context.lvl}}</title>    
    <link type="text/css" href="{{ url_for('static', filename='css/level.css')}}" rel="stylesheet">
</head>
<body>
    
    <table id="game-table">
    </table>
    

    
    <img id="hero" class="game-object" src="{{ url_for('static', filename='images/hero1.jpg')}}">
    <!-- <img id="hero" class="game-object" src="{{ url_for('static', filename='images/hero2.jpg')}}">
    <img id="hero" class="game-object" src="{{ url_for('static', filename='images/hero3.jpg')}}"> -->

    <!--
        w -- wall
        s -- spikes
        b -- стартовая точка
        d -- door
        c -- coin
        0 -- ничего
        p - platform
    -->


    <script> 
        
        let gameObjects = {
            w: `<img id="image4"  class="game-object" src="{{ url_for('static', filename='images/wall.jpg')}}">`,
            s: `<img id="image3"  class="game-object" src="{{ url_for('static', filename='images/spikes.png')}}">`,
            d: `<img id="image2"  class="game-object" src="{{ url_for('static', filename='images/door.png')}}">`,
            c: `<img id="image1" class="game-object" src="{{ url_for('static', filename='images/coin.png')}}">`,
            p: `<img id="image5" class="game-object" src="{{ url_for('static', filename='images/platform.png')}}">`,

            b: `<img id="image5" class="game-object" src="{{ url_for('static', filename='images/kvadrat.jpg')}}">`,
            0: `<img id="image5" class="game-object" src="{{ url_for('static', filename='images/kvadrat.jpg')}}">`
        };
        let mat = [        
            {% for row in context.mat %}
                "{{ row }}", 
            {% endfor %}
        ];
        
        
        const gameTable = document.getElementById('game-table');
        
        let content = '';
        for (let i = 0; i < mat.length; i++) {
            content += "<tr>";
            for (let j = 0; j < mat[i].length; j++){
                /*if ('wcsdp'.includes(mat[i][j]))*/
                    content += `<td> ${gameObjects[mat[i][j]]} </td>`;
                /*else
                    content += "<td> </td>";*/
            }
            
            content += "</tr>"; 
        }
        gameTable.innerHTML += content;
        const hero = document.getElementById('hero');
        let heroX = 100;
        let heroY = 150;
        hero.style.left = `${heroX}px`;
        hero.style.top = `${heroY}px`;

        speedX = 15;
        speedY = 0;
        side = 50;
        function checkCollision(){
            /* heroX heroY mat[][]*/
            let posUpSide = parseInt(heroY / side);            
            let posDownSide = posUpSide + 1;
            let posLeftSide = parseInt(heroX / side);
            let posRightSide = posLeftSide + 1;
            if (mat[posDownSide][posLeftSide] == 'w' || mat[posDownSide][posRightSide] == 'w'){
                heroY = posUpSide * side;
                speedY = 0;
            }
        }
        function move() {
            heroX += speedX;
            heroY += speedY; 
            speedY += 5;
            checkCollision();
            if (heroX > 850){
                console.log("Дошли до стенки");
                speedX = speedX * -1;
                hero.style.transform = `scaleX(-1)`;
            }
            else if( heroX < 0) {
                console.log("Дошли");
                speedX = speedX * -1; 
                hero.style.transform = `scaleX(1)`;
            }

            else{
                hero.style.left = `${heroX}px`;
                hero.style.top = `${heroY}px`;
            };
        }
        function jump(event) {
            if (event.keyCode == '32') {
                console.log('Прыжок!');
                speedY = -50
            }
        }
        document.addEventListener('keydown', jump);
        
        let timerId = setInterval(move, 200);
    </script>
        
</body>
</html>